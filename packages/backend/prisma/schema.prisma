// Prisma schema, more in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// RC: Retrieval Conversational
model RCConversation {
  id          Int               @id @default(autoincrement())
  title       String
  documentId  Int?
  document    DocumentMetadata? @relation("DocumentMetadata", fields: [documentId], references: [id])
  chatHistory Message[]
  rcAgentId   Int?
  rcAgent     Bot?              @relation(fields: [rcAgentId], references: [id])
}

model Bot {
  id             Int              @id @default(autoincrement())
  name           String           @unique()
  RCConversation RCConversation[]
  description    String?
  type           BotType
  configVersion  String           @default("0.0.1")
  configuration  Json
}

model Message {
  id       Int             @id @default(autoincrement())
  type     String
  content  String
  fromId   Int?
  fromType String
  rcId     Int?
  rc       RCConversation? @relation(fields: [rcId], references: [id])
}

model DocumentMetadata {
  id                   Int              @id @default(autoincrement())
  title                String
  size                 Int
  url                  String
  embeddedAt           DateTime         @default(now())
  embeddingStatus      String
  ConversationDocument RCConversation[] @relation("DocumentMetadata")
}

enum BotType {
  CONVERSATIONAL
  RETRIEVAL_CONVERSATIONAL
}
